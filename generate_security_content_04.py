#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Security Content Generator for Authentication Topics
Updates security.json with detailed content for 03_ì¸ì¦ sections
"""

import json


def get_authentication_content():
    """ì¸ì¦ (Authentication) content"""
    return {
        "id": "03_ì¸ì¦/authentication",
        "title": "ì¸ì¦ (Authentication)",
        "category": "security",
        "subCategory": "03_ì¸ì¦",
        "language": "Java",
        "description": "ì¸ì¦ì˜ ê°œë…, JWTì™€ Session ë°©ì‹ì˜ ì°¨ì´ì , Spring Security 6 ê¸°ë°˜ ì¸ì¦ êµ¬í˜„ì„ í•™ìŠµí•©ë‹ˆë‹¤.",
        "isPlaceholder": False,
        "sections": [
            {
                "type": "concept",
                "title": "ğŸ” ì¸ì¦ (Authentication) ì™„ì „ ì •ë³µ",
                "content": "## í•œ ì¤„ ìš”ì•½\n> **\"ë„ˆ ëˆ„êµ¬ì•¼?\"** - ì‚¬ìš©ìê°€ ì£¼ì¥í•˜ëŠ” ì‹ ì›ì´ ì§„ì§œì¸ì§€ í™•ì¸í•˜ëŠ” ê³¼ì •!\n\n---\n\n## ğŸ’¡ ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°\n\n```\nğŸ¢ íšŒì‚¬ ì¶œì…ì— ë¹„ìœ í•˜ë©´:\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚           ğŸ” ì¸ì¦ (Authentication)       â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                         â”‚\nâ”‚   [ì§ì›]    â†’    [ê²½ë¹„ì‹¤]    â†’   [ì¶œì…]  â”‚\nâ”‚     â”‚              â”‚              â”‚     â”‚\nâ”‚   ì‚¬ì›ì¦ ì œì‹œ    ì‹ ì› í™•ì¸      í†µê³¼/ê±°ë¶€ â”‚\nâ”‚                                         â”‚\nâ”‚   ì›¹ì—ì„œëŠ”:                              â”‚\nâ”‚   â€¢ ID/PW ì…ë ¥ â†’ ì„œë²„ ê²€ì¦ â†’ ë¡œê·¸ì¸     â”‚\nâ”‚   â€¢ JWT í† í° â†’ ì„œëª… ê²€ì¦ â†’ API ì ‘ê·¼     â”‚\nâ”‚   â€¢ OAuth â†’ ì œ3ì ì¸ì¦ â†’ ì„œë¹„ìŠ¤ ì´ìš©    â”‚\nâ”‚                                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## ğŸ”„ JWT vs Session ë¹„êµ\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚               Session ë°©ì‹ (Stateful)                    â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  [ë¸Œë¼ìš°ì €]              [ì„œë²„]              [ì„¸ì…˜ì €ì¥ì†Œ] â”‚\nâ”‚      â”‚                     â”‚                     â”‚      â”‚\nâ”‚      â”‚â”€â”€â”€ ID/PW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚      â”‚\nâ”‚      â”‚                     â”‚â”€â”€â”€ ì„¸ì…˜ ìƒì„± â”€â”€â”€â”€â”€â”€â–ºâ”‚      â”‚\nâ”‚      â”‚â—„â”€â”€ Session ID â”€â”€â”€â”€â”€â”‚                     â”‚      â”‚\nâ”‚      â”‚   (ì¿ í‚¤ ì €ì¥)        â”‚                     â”‚      â”‚\nâ”‚      â”‚                     â”‚                     â”‚      â”‚\nâ”‚      â”‚â”€â”€â”€ ìš”ì²­ + ì¿ í‚¤ â”€â”€â”€â”€â–ºâ”‚â”€â”€â”€ ì„¸ì…˜ ì¡°íšŒ â”€â”€â”€â”€â”€â”€â–ºâ”‚      â”‚\nâ”‚      â”‚                     â”‚â—„â”€â”€ ì‚¬ìš©ì ì •ë³´ â”€â”€â”€â”€â”‚      â”‚\nâ”‚      â”‚â—„â”€â”€ ì‘ë‹µ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                JWT ë°©ì‹ (Stateless)                      â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  [ë¸Œë¼ìš°ì €]              [ì„œë²„]                          â”‚\nâ”‚      â”‚                     â”‚                            â”‚\nâ”‚      â”‚â”€â”€â”€ ID/PW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                            â”‚\nâ”‚      â”‚                     â”‚ JWT ìƒì„± (ì„œëª… í¬í•¨)        â”‚\nâ”‚      â”‚â—„â”€â”€ JWT í† í° â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚\nâ”‚      â”‚   (ì €ì¥)            â”‚                            â”‚\nâ”‚      â”‚                     â”‚                            â”‚\nâ”‚      â”‚â”€â”€â”€ ìš”ì²­ + JWT â”€â”€â”€â”€â”€â–ºâ”‚                            â”‚\nâ”‚      â”‚                     â”‚ ì„œëª… ê²€ì¦ë§Œ (DB ì¡°íšŒ X)     â”‚\nâ”‚      â”‚â—„â”€â”€ ì‘ë‹µ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n| êµ¬ë¶„ | Session | JWT |\n|------|---------|-----|\n| ìƒíƒœ | Stateful (ì„œë²„ ì €ì¥) | Stateless (í´ë¼ì´ì–¸íŠ¸ ì €ì¥) |\n| í™•ì¥ì„± | ì„¸ì…˜ ê³µìœ  í•„ìš” | ì„œë²„ í™•ì¥ ìš©ì´ |\n| ë³´ì•ˆ | ì„œë²„ì—ì„œ ë¬´íš¨í™” ê°€ëŠ¥ | ë§Œë£Œ ì „ ë¬´íš¨í™” ì–´ë ¤ì›€ |\n| ì €ì¥ì†Œ | Redis, DB í•„ìš” | ë¶ˆí•„ìš” |\n| ì í•© | ì „í†µì  ì›¹ì•± | MSA, ëª¨ë°”ì¼ API |\n\n---\n\n## ğŸš¨ ì‹¤ì œ ì‚¬ê³  ì‚¬ë¡€\n\n```\nğŸ“Œ 2023ë…„ Okta ì¸ì¦ ìš°íšŒ ì‚¬ê³ \nì›ì¸: ì„¸ì…˜ í† í° íƒˆì·¨ë¡œ ê³ ê° ì‹œìŠ¤í…œ ì ‘ê·¼\ní”¼í•´: 134ê°œ ê³ ê°ì‚¬ ì˜í–¥\nêµí›ˆ: ì„¸ì…˜ ê´€ë¦¬ ê°•í™”, IP ë°”ì¸ë”© í•„ìš”\n\nğŸ“Œ 2021ë…„ JWT ì•Œê³ ë¦¬ì¦˜ í˜¼ë™ ê³µê²©\nì›ì¸: alg:none í—ˆìš©, RS256â†’HS256 ë³€ì¡°\ní”¼í•´: ì¸ì¦ ìš°íšŒë¡œ ê´€ë¦¬ì ê¶Œí•œ íšë“\nêµí›ˆ: ì•Œê³ ë¦¬ì¦˜ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ í•„ìˆ˜\n\nğŸ“Œ 2019ë…„ Facebook í† í° ìœ ì¶œ\nì›ì¸: Access Token 5000ë§Œ ê°œ ë…¸ì¶œ\ní”¼í•´: ê³„ì • íƒˆì·¨ ê°€ëŠ¥ ìƒíƒœ\nêµí›ˆ: í† í° ë²”ìœ„ ìµœì†Œí™”, ì§§ì€ ë§Œë£Œ\n```"
            },
            {
                "type": "code",
                "title": "ğŸ’» êµ¬í˜„ ì½”ë“œ",
                "content": "### Spring Security 6 ê¸°ë³¸ ì„¤ì •\n\n```java\n@Configuration\n@EnableWebSecurity\n@EnableMethodSecurity(prePostEnabled = true)\npublic class SecurityConfig {\n\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        http\n            // CSRF ì„¤ì • (REST APIëŠ” ë¹„í™œì„±í™”)\n            .csrf(csrf -> csrf.disable())\n            \n            // ì„¸ì…˜ ì •ì±… (JWT ì‚¬ìš© ì‹œ STATELESS)\n            .sessionManagement(session -> session\n                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)\n            )\n            \n            // ìš”ì²­ ê¶Œí•œ ì„¤ì •\n            .authorizeHttpRequests(auth -> auth\n                .requestMatchers(\"/api/auth/**\").permitAll()\n                .requestMatchers(\"/api/public/**\").permitAll()\n                .requestMatchers(\"/api/admin/**\").hasRole(\"ADMIN\")\n                .anyRequest().authenticated()\n            )\n            \n            // JWT í•„í„° ì¶”ê°€\n            .addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class)\n            \n            // ì˜ˆì™¸ ì²˜ë¦¬\n            .exceptionHandling(ex -> ex\n                .authenticationEntryPoint(jwtAuthEntryPoint)\n                .accessDeniedHandler(accessDeniedHandler)\n            );\n\n        return http.build();\n    }\n\n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        return new BCryptPasswordEncoder(12);\n    }\n\n    @Bean\n    public AuthenticationManager authenticationManager(\n            AuthenticationConfiguration config) throws Exception {\n        return config.getAuthenticationManager();\n    }\n}\n```\n\n### JWT í† í° ìƒì„± ë° ê²€ì¦\n\n```java\n@Service\n@RequiredArgsConstructor\npublic class JwtService {\n    \n    @Value(\"${jwt.secret}\")\n    private String secretKey;\n    \n    @Value(\"${jwt.expiration}\")\n    private long expiration;  // 1ì‹œê°„\n    \n    // í† í° ìƒì„±\n    public String generateToken(UserDetails userDetails) {\n        Map<String, Object> claims = new HashMap<>();\n        claims.put(\"roles\", userDetails.getAuthorities());\n        \n        return Jwts.builder()\n                .setClaims(claims)\n                .setSubject(userDetails.getUsername())\n                .setIssuedAt(new Date())\n                .setExpiration(new Date(System.currentTimeMillis() + expiration))\n                .signWith(getSigningKey(), SignatureAlgorithm.HS256)\n                .compact();\n    }\n    \n    // í† í° ê²€ì¦\n    public boolean validateToken(String token, UserDetails userDetails) {\n        final String username = extractUsername(token);\n        return username.equals(userDetails.getUsername()) \n               && !isTokenExpired(token);\n    }\n    \n    // ì‚¬ìš©ìëª… ì¶”ì¶œ\n    public String extractUsername(String token) {\n        return extractClaim(token, Claims::getSubject);\n    }\n    \n    private Key getSigningKey() {\n        byte[] keyBytes = Decoders.BASE64.decode(secretKey);\n        return Keys.hmacShaKeyFor(keyBytes);\n    }\n    \n    private boolean isTokenExpired(String token) {\n        return extractExpiration(token).before(new Date());\n    }\n}\n```\n\n### JWT ì¸ì¦ í•„í„°\n\n```java\n@Component\n@RequiredArgsConstructor\npublic class JwtAuthenticationFilter extends OncePerRequestFilter {\n    \n    private final JwtService jwtService;\n    private final UserDetailsService userDetailsService;\n    \n    @Override\n    protected void doFilterInternal(\n            HttpServletRequest request,\n            HttpServletResponse response,\n            FilterChain filterChain) throws ServletException, IOException {\n        \n        // Authorization í—¤ë”ì—ì„œ í† í° ì¶”ì¶œ\n        final String authHeader = request.getHeader(\"Authorization\");\n        if (authHeader == null || !authHeader.startsWith(\"Bearer \")) {\n            filterChain.doFilter(request, response);\n            return;\n        }\n        \n        final String jwt = authHeader.substring(7);\n        final String username = jwtService.extractUsername(jwt);\n        \n        // ì¸ì¦ ì²˜ë¦¬\n        if (username != null && SecurityContextHolder.getContext().getAuthentication() == null) {\n            UserDetails userDetails = userDetailsService.loadUserByUsername(username);\n            \n            if (jwtService.validateToken(jwt, userDetails)) {\n                UsernamePasswordAuthenticationToken authToken =\n                    new UsernamePasswordAuthenticationToken(\n                        userDetails, null, userDetails.getAuthorities());\n                authToken.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));\n                SecurityContextHolder.getContext().setAuthentication(authToken);\n            }\n        }\n        \n        filterChain.doFilter(request, response);\n    }\n}\n```"
            },
            {
                "type": "code",
                "title": "ğŸ›¡ï¸ ì‹¤ì „ ë³´ì•ˆ",
                "content": "### OAuth2 ë¡œê·¸ì¸ ì—°ë™ (Google, Kakao)\n\n```java\n@Configuration\n@EnableWebSecurity\npublic class OAuth2SecurityConfig {\n\n    @Bean\n    public SecurityFilterChain oauth2FilterChain(HttpSecurity http) throws Exception {\n        http\n            .oauth2Login(oauth2 -> oauth2\n                .loginPage(\"/login\")\n                .userInfoEndpoint(userInfo -> userInfo\n                    .userService(customOAuth2UserService)\n                )\n                .successHandler(oAuth2SuccessHandler)\n                .failureHandler(oAuth2FailureHandler)\n            );\n        return http.build();\n    }\n}\n\n@Service\n@RequiredArgsConstructor\npublic class CustomOAuth2UserService extends DefaultOAuth2UserService {\n    \n    private final UserRepository userRepository;\n    \n    @Override\n    public OAuth2User loadUser(OAuth2UserRequest request) throws OAuth2AuthenticationException {\n        OAuth2User oauth2User = super.loadUser(request);\n        \n        String provider = request.getClientRegistration().getRegistrationId();\n        String providerId = oauth2User.getAttribute(\"sub\"); // Google\n        String email = oauth2User.getAttribute(\"email\");\n        \n        // ê¸°ì¡´ íšŒì› ì¡°íšŒ ë˜ëŠ” ì‹ ê·œ ê°€ì…\n        User user = userRepository.findByProviderAndProviderId(provider, providerId)\n            .orElseGet(() -> registerNewUser(provider, providerId, email));\n        \n        return new CustomOAuth2User(user, oauth2User.getAttributes());\n    }\n}\n```\n\n### ì„¸ì…˜ ê´€ë¦¬ ë° ë™ì‹œ ë¡œê·¸ì¸ ì œì–´\n\n```java\n@Configuration\npublic class SessionConfig {\n\n    @Bean\n    public SecurityFilterChain sessionFilterChain(HttpSecurity http) throws Exception {\n        http\n            .sessionManagement(session -> session\n                // ë™ì‹œ ì„¸ì…˜ 1ê°œë¡œ ì œí•œ\n                .maximumSessions(1)\n                // ê¸°ì¡´ ì„¸ì…˜ ë§Œë£Œ (ìƒˆ ë¡œê·¸ì¸ í—ˆìš©)\n                .maxSessionsPreventsLogin(false)\n                // ì„¸ì…˜ ë§Œë£Œ ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸\n                .expiredUrl(\"/login?expired\")\n            )\n            // ì„¸ì…˜ ê³ ì • ê³µê²© ë°©ì§€\n            .sessionManagement(session -> session\n                .sessionFixation().changeSessionId()\n            );\n        return http.build();\n    }\n    \n    // Redis ì„¸ì…˜ ì €ì¥ì†Œ (ë¶„ì‚° í™˜ê²½)\n    @Bean\n    public RedisConnectionFactory redisConnectionFactory() {\n        return new LettuceConnectionFactory();\n    }\n}\n```\n\n### Refresh Token êµ¬í˜„ (í† í° ê°±ì‹ )\n\n```java\n@Service\n@RequiredArgsConstructor\npublic class RefreshTokenService {\n    \n    private final RefreshTokenRepository refreshTokenRepository;\n    private final JwtService jwtService;\n    \n    @Value(\"${jwt.refresh-expiration}\")\n    private long refreshExpiration;  // 7ì¼\n    \n    // Refresh Token ìƒì„±\n    public RefreshToken createRefreshToken(String username) {\n        RefreshToken refreshToken = RefreshToken.builder()\n            .username(username)\n            .token(UUID.randomUUID().toString())\n            .expiryDate(Instant.now().plusMillis(refreshExpiration))\n            .build();\n        return refreshTokenRepository.save(refreshToken);\n    }\n    \n    // Access Token ê°±ì‹ \n    public TokenResponse refreshAccessToken(String refreshTokenStr) {\n        RefreshToken refreshToken = refreshTokenRepository.findByToken(refreshTokenStr)\n            .orElseThrow(() -> new TokenRefreshException(\"Refresh token not found\"));\n        \n        if (refreshToken.getExpiryDate().isBefore(Instant.now())) {\n            refreshTokenRepository.delete(refreshToken);\n            throw new TokenRefreshException(\"Refresh token expired\");\n        }\n        \n        UserDetails userDetails = userDetailsService.loadUserByUsername(\n            refreshToken.getUsername());\n        String newAccessToken = jwtService.generateToken(userDetails);\n        \n        return TokenResponse.builder()\n            .accessToken(newAccessToken)\n            .refreshToken(refreshTokenStr)\n            .build();\n    }\n    \n    // ë¡œê·¸ì•„ì›ƒ ì‹œ Refresh Token ì‚­ì œ\n    public void deleteByUsername(String username) {\n        refreshTokenRepository.deleteByUsername(username);\n    }\n}\n```"
            },
            {
                "type": "tip",
                "title": "ğŸ’¡ ì²´í¬ë¦¬ìŠ¤íŠ¸ & ë©´ì ‘",
                "content": "### ì‹¤ë¬´ ì²´í¬ë¦¬ìŠ¤íŠ¸\n\n```\n[ JWT ë³´ì•ˆ ]\nâ–¡ ì‹œí¬ë¦¿ í‚¤ 256ë¹„íŠ¸ ì´ìƒ (HS256 ê¸°ì¤€)\nâ–¡ í† í° ë§Œë£Œ ì‹œê°„ ì ì ˆíˆ ì„¤ì • (Access: 1ì‹œê°„, Refresh: 7ì¼)\nâ–¡ ì•Œê³ ë¦¬ì¦˜ ëª…ì‹œì  ì§€ì • (alg:none ë°©ì§€)\nâ–¡ Refresh Token DB ì €ì¥ ë° ê´€ë¦¬\nâ–¡ ë¡œê·¸ì•„ì›ƒ ì‹œ í† í° ë¬´íš¨í™” ì²˜ë¦¬\n\n[ Session ë³´ì•ˆ ]\nâ–¡ ì„¸ì…˜ ID HttpOnly, Secure í”Œë˜ê·¸\nâ–¡ ì„¸ì…˜ ê³ ì • ê³µê²© ë°©ì§€ (ë¡œê·¸ì¸ ì‹œ ì„¸ì…˜ ID ë³€ê²½)\nâ–¡ ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ì„¤ì • (30ë¶„ ê¶Œì¥)\nâ–¡ ë™ì‹œ ì„¸ì…˜ ì œí•œ\n\n[ ê³µí†µ ]\nâ–¡ HTTPS ê°•ì œ ì ìš©\nâ–¡ ë¹„ë°€ë²ˆí˜¸ BCrypt í•´ì‹œ (cost 12 ì´ìƒ)\nâ–¡ ë¡œê·¸ì¸ ì‹¤íŒ¨ íšŸìˆ˜ ì œí•œ\nâ–¡ ë¡œê·¸ì¸ ì´ë ¥ ë¡œê¹…\n```\n\n---\n\n### ë©´ì ‘ ì˜ˆìƒ ì§ˆë¬¸\n\n```\nğŸ‘¶ ì£¼ë‹ˆì–´ ë ˆë²¨:\n\nQ: ì¸ì¦(Authentication)ê³¼ ì¸ê°€(Authorization)ì˜ ì°¨ì´ëŠ”?\nA: ì¸ì¦ì€ \"ë„ˆ ëˆ„êµ¬ì•¼?\" (ì‹ ì› í™•ì¸), ì¸ê°€ëŠ” \"ë„ˆ ì´ê±° í•´ë„ ë¼?\" (ê¶Œí•œ í™•ì¸)\n\nQ: JWTì™€ Session ë°©ì‹ì˜ ì°¨ì´ì ì€?\nA: JWTëŠ” Statelessë¡œ ì„œë²„ì— ìƒíƒœ ì €ì¥ ì•ˆ í•¨, Sessionì€ Statefulë¡œ ì„œë²„ì— ì„¸ì…˜ ì €ì¥.\n   JWTëŠ” í™•ì¥ì„± ì¢‹ê³ , Sessionì€ ì„œë²„ì—ì„œ ë¬´íš¨í™” ì‰¬ì›€.\n\nQ: JWT í† í°ì€ ì–´ë””ì— ì €ì¥í•˜ë‚˜ìš”?\nA: localStorage(XSS ì·¨ì•½), httpOnly ì¿ í‚¤(CSRF ì·¨ì•½, ë” ì•ˆì „),\n   ë©”ëª¨ë¦¬(ìƒˆë¡œê³ ì¹¨ ì‹œ ìœ ì‹¤). ë³´í†µ httpOnly ì¿ í‚¤ ê¶Œì¥.\n\nğŸ‘¨â€ğŸ’¼ ì‹œë‹ˆì–´ ë ˆë²¨:\n\nQ: JWT í† í° íƒˆì·¨ ì‹œ ëŒ€ì‘ ë°©ì•ˆì€?\nA: ì§§ì€ ë§Œë£Œì‹œê°„ + Refresh Token ì¡°í•©, í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸, IP/ë””ë°”ì´ìŠ¤ ë°”ì¸ë”©,\n   Refresh Token Rotation ì ìš©\n\nQ: ë¶„ì‚° í™˜ê²½ì—ì„œ ì„¸ì…˜ ê´€ë¦¬ ë°©ë²•ì€?\nA: Redisë¥¼ ì„¸ì…˜ ì €ì¥ì†Œë¡œ ì‚¬ìš©í•˜ì—¬ ì„¸ì…˜ ê³µìœ , ë˜ëŠ” JWT ë°©ì‹ìœ¼ë¡œ Stateless ì „í™˜\n\nQ: OAuth2ì˜ Authorization Code Flowë¥¼ ì„¤ëª…í•˜ì„¸ìš”.\nA: í´ë¼ì´ì–¸íŠ¸ê°€ ì¸ì¦ì„œë²„ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ â†’ ì‚¬ìš©ì ë¡œê·¸ì¸ â†’ Authorization Code ë°œê¸‰\n   â†’ í´ë¼ì´ì–¸íŠ¸ê°€ Codeë¡œ Access Token êµí™˜ â†’ ë¦¬ì†ŒìŠ¤ ì„œë²„ ì ‘ê·¼\n```\n\n---\n\n### application.yml ì„¤ì • ì˜ˆì‹œ\n\n```yaml\njwt:\n  secret: ${JWT_SECRET}  # í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬\n  expiration: 3600000    # 1ì‹œê°„ (ë°€ë¦¬ì´ˆ)\n  refresh-expiration: 604800000  # 7ì¼\n\nspring:\n  security:\n    oauth2:\n      client:\n        registration:\n          google:\n            client-id: ${GOOGLE_CLIENT_ID}\n            client-secret: ${GOOGLE_CLIENT_SECRET}\n            scope: email, profile\n```"
            }
        ]
    }


def get_authorization_content():
    """ì¸ê°€ (Authorization) content"""
    return {
        "id": "03_ì¸ì¦/authorization",
        "title": "ì¸ê°€ (Authorization)",
        "category": "security",
        "subCategory": "03_ì¸ì¦",
        "language": "Java",
        "description": "ì¸ê°€ì˜ ê°œë…, RBAC/ABAC ëª¨ë¸, Spring Security ê¸°ë°˜ ê¶Œí•œ ê´€ë¦¬ë¥¼ í•™ìŠµí•©ë‹ˆë‹¤.",
        "isPlaceholder": False,
        "sections": [
            {
                "type": "concept",
                "title": "ğŸ” ì¸ê°€ (Authorization) ì™„ì „ ì •ë³µ",
                "content": "## í•œ ì¤„ ìš”ì•½\n> **\"ë„ˆ ì´ê±° í•´ë„ ë¼?\"** - ì¸ì¦ëœ ì‚¬ìš©ìê°€ íŠ¹ì • ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ê³¼ì •!\n\n---\n\n## ğŸ’¡ ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°\n\n```\nğŸ¢ íšŒì‚¬ ë³´ì•ˆ ì‹œìŠ¤í…œì— ë¹„ìœ í•˜ë©´:\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚         ğŸ” ì¸ê°€ (Authorization)          â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                         â”‚\nâ”‚   [ì¸ì¦ ì™„ë£Œ]                            â”‚\nâ”‚       â†“                                 â”‚\nâ”‚   ì‚¬ì›ì¦ìœ¼ë¡œ ì¶œì… (ì¸ì¦) âœ…               â”‚\nâ”‚       â†“                                 â”‚\nâ”‚   ì„œë²„ì‹¤ ì ‘ê·¼ ì‹œë„                        â”‚\nâ”‚       â†“                                 â”‚\nâ”‚   \"ITíŒ€ë§Œ ì¶œì… ê°€ëŠ¥\" â†’ ê¶Œí•œ í™•ì¸ (ì¸ê°€)   â”‚\nâ”‚       â†“                                 â”‚\nâ”‚   ITíŒ€ âœ… â†’ ì¶œì… í—ˆìš©                    â”‚\nâ”‚   ë§ˆì¼€íŒ…íŒ€ âŒ â†’ ì¶œì… ê±°ë¶€                 â”‚\nâ”‚                                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## ğŸ”„ RBAC vs ABAC ë¹„êµ\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              RBAC (Role-Based Access Control)            â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ - ì—­í• ì— ê¶Œí•œ ë¶€ì—¬                   â”‚\nâ”‚                                                         â”‚\nâ”‚   [ì‚¬ìš©ì] â”€â”€â–º [ì—­í• ] â”€â”€â–º [ê¶Œí•œ] â”€â”€â–º [ë¦¬ì†ŒìŠ¤]            â”‚\nâ”‚                                                         â”‚\nâ”‚   ì˜ˆì‹œ:                                                  â”‚\nâ”‚   í™ê¸¸ë™ â†’ ADMIN ì—­í•  â†’ ëª¨ë“  ê¶Œí•œ â†’ ì „ì²´ ì ‘ê·¼            â”‚\nâ”‚   ê¹€ì² ìˆ˜ â†’ USER ì—­í•  â†’ ì½ê¸° ê¶Œí•œ â†’ ì œí•œì  ì ‘ê·¼           â”‚\nâ”‚                                                         â”‚\nâ”‚   ì¥ì : ë‹¨ìˆœ, ê´€ë¦¬ ì‰¬ì›€                                  â”‚\nâ”‚   ë‹¨ì : ì„¸ë°€í•œ ì œì–´ ì–´ë ¤ì›€                               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚           ABAC (Attribute-Based Access Control)          â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  ì†ì„± ê¸°ë°˜ ì ‘ê·¼ ì œì–´ - ì¡°ê±´ì— ë”°ë¼ ë™ì  íŒë‹¨              â”‚\nâ”‚                                                         â”‚\nâ”‚   [ì£¼ì²´ ì†ì„±] + [ë¦¬ì†ŒìŠ¤ ì†ì„±] + [í™˜ê²½ ì†ì„±] â†’ [ê²°ì •]      â”‚\nâ”‚                                                         â”‚\nâ”‚   ì˜ˆì‹œ:                                                  â”‚\nâ”‚   IF ë¶€ì„œ = \"ì¸ì‚¬íŒ€\"                                    â”‚\nâ”‚   AND ê·¼ë¬´ì‹œê°„ = true                                   â”‚\nâ”‚   AND ë¦¬ì†ŒìŠ¤.ë¶„ë¥˜ = \"ì¸ì‚¬ìë£Œ\"                          â”‚\nâ”‚   THEN ì ‘ê·¼ í—ˆìš©                                        â”‚\nâ”‚                                                         â”‚\nâ”‚   ì¥ì : ì„¸ë°€í•œ ì œì–´, ë™ì  ì •ì±…                           â”‚\nâ”‚   ë‹¨ì : ë³µì¡, ì„±ëŠ¥ ê³ ë ¤ í•„ìš”                             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n| êµ¬ë¶„ | RBAC | ABAC |\n|------|------|------|\n| ê¸°ì¤€ | ì—­í•  (Role) | ì†ì„± (Attribute) |\n| ë³µì¡ë„ | ë‹¨ìˆœ | ë³µì¡ |\n| ìœ ì—°ì„± | ë‚®ìŒ | ë†’ìŒ |\n| ì„±ëŠ¥ | ë¹ ë¦„ | ìƒëŒ€ì  ëŠë¦¼ |\n| ì í•© | ì¼ë°˜ ì›¹ì•± | ëŒ€ê¸°ì—…, ê¸ˆìœµ, ì˜ë£Œ |\n\n---\n\n## ğŸš¨ ì‹¤ì œ ì‚¬ê³  ì‚¬ë¡€\n\n```\nğŸ“Œ 2021ë…„ Parler ë°ì´í„° ìœ ì¶œ\nì›ì¸: API ì¸ê°€ ê²€ì¦ ëˆ„ë½ (IDOR ì·¨ì•½ì )\ní”¼í•´: 7000ë§Œ ê²Œì‹œë¬¼, GPS ì •ë³´ í¬í•¨ ì „ì²´ ìœ ì¶œ\nêµí›ˆ: ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ ê¶Œí•œ ê²€ì¦ í•„ìˆ˜\n\nğŸ“Œ 2019ë…„ Capital One í•´í‚¹\nì›ì¸: AWS IAM ì—­í•  ê³¼ë„í•œ ê¶Œí•œ ë¶€ì—¬\ní”¼í•´: 1ì–µ+ ê³ ê° ì •ë³´ ìœ ì¶œ\nêµí›ˆ: ìµœì†Œ ê¶Œí•œ ì›ì¹™(Principle of Least Privilege)\n\nğŸ“Œ 2023ë…„ Microsoft Power Platform\nì›ì¸: ê¸°ë³¸ ê¶Œí•œ ì„¤ì • ì˜¤ë¥˜\ní”¼í•´: 38TB ë‚´ë¶€ ë°ì´í„° ë…¸ì¶œ\nêµí›ˆ: ê¸°ë³¸ê°’ì€ í•­ìƒ ìµœì†Œ ê¶Œí•œìœ¼ë¡œ\n```"
            },
            {
                "type": "code",
                "title": "ğŸ’» êµ¬í˜„ ì½”ë“œ",
                "content": "### Spring Security 6 ê¶Œí•œ ì„¤ì •\n\n```java\n@Configuration\n@EnableWebSecurity\n@EnableMethodSecurity(prePostEnabled = true, securedEnabled = true)\npublic class AuthorizationConfig {\n\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        http\n            .authorizeHttpRequests(auth -> auth\n                // ê³µê°œ API\n                .requestMatchers(\"/api/public/**\").permitAll()\n                \n                // ì¸ì¦ë§Œ í•„ìš”\n                .requestMatchers(\"/api/user/**\").authenticated()\n                \n                // íŠ¹ì • ì—­í•  í•„ìš”\n                .requestMatchers(\"/api/admin/**\").hasRole(\"ADMIN\")\n                .requestMatchers(\"/api/manager/**\").hasAnyRole(\"ADMIN\", \"MANAGER\")\n                \n                // íŠ¹ì • ê¶Œí•œ í•„ìš”\n                .requestMatchers(HttpMethod.DELETE, \"/api/posts/**\")\n                    .hasAuthority(\"POST_DELETE\")\n                \n                // IP ê¸°ë°˜ ì œí•œ\n                .requestMatchers(\"/api/internal/**\")\n                    .access(new WebExpressionAuthorizationManager(\n                        \"hasIpAddress('192.168.1.0/24')\"))\n                \n                // ë‚˜ë¨¸ì§€ëŠ” ì¸ì¦ í•„ìš”\n                .anyRequest().authenticated()\n            );\n        return http.build();\n    }\n}\n```\n\n### ë©”ì„œë“œ ë ˆë²¨ ê¶Œí•œ ì œì–´\n\n```java\n@Service\npublic class PostService {\n    \n    // ì—­í•  ê¸°ë°˜ ì œì–´\n    @Secured(\"ROLE_ADMIN\")\n    public void deleteAllPosts() {\n        // ADMINë§Œ ì „ì²´ ì‚­ì œ ê°€ëŠ¥\n    }\n    \n    // SpEL í‘œí˜„ì‹ ì‚¬ìš©\n    @PreAuthorize(\"hasRole('ADMIN') or hasRole('MANAGER')\")\n    public List<Post> getAllPosts() {\n        return postRepository.findAll();\n    }\n    \n    // íŒŒë¼ë¯¸í„° ê¸°ë°˜ ê¶Œí•œ ì²´í¬\n    @PreAuthorize(\"#userId == authentication.principal.id or hasRole('ADMIN')\")\n    public User getUser(@Param(\"userId\") Long userId) {\n        // ë³¸ì¸ ë˜ëŠ” ADMINë§Œ ì¡°íšŒ ê°€ëŠ¥\n        return userRepository.findById(userId).orElseThrow();\n    }\n    \n    // ë°˜í™˜ê°’ ê¸°ë°˜ ê¶Œí•œ ì²´í¬\n    @PostAuthorize(\"returnObject.author.id == authentication.principal.id\")\n    public Post getPost(Long postId) {\n        // ì¡°íšŒ í›„ ë³¸ì¸ ê²Œì‹œë¬¼ì¸ì§€ í™•ì¸\n        return postRepository.findById(postId).orElseThrow();\n    }\n    \n    // ì»¬ë ‰ì…˜ í•„í„°ë§\n    @PostFilter(\"filterObject.isPublic or filterObject.author.id == authentication.principal.id\")\n    public List<Post> getMyPosts() {\n        // ê³µê°œ ê²Œì‹œë¬¼ + ë³¸ì¸ ê²Œì‹œë¬¼ë§Œ ë°˜í™˜\n        return postRepository.findAll();\n    }\n}\n```\n\n### ì»¤ìŠ¤í…€ ê¶Œí•œ í‰ê°€ì\n\n```java\n@Component\npublic class CustomPermissionEvaluator implements PermissionEvaluator {\n    \n    @Autowired\n    private PostRepository postRepository;\n    \n    @Override\n    public boolean hasPermission(\n            Authentication auth, Object targetDomainObject, Object permission) {\n        \n        if (targetDomainObject instanceof Post post) {\n            User user = (User) auth.getPrincipal();\n            \n            return switch (permission.toString()) {\n                case \"READ\" -> post.isPublic() || post.getAuthor().equals(user);\n                case \"WRITE\" -> post.getAuthor().equals(user);\n                case \"DELETE\" -> post.getAuthor().equals(user) \n                                 || user.hasRole(\"ADMIN\");\n                default -> false;\n            };\n        }\n        return false;\n    }\n    \n    @Override\n    public boolean hasPermission(\n            Authentication auth, Serializable targetId, \n            String targetType, Object permission) {\n        // IDë¡œ ì¡°íšŒ í›„ ê¶Œí•œ ì²´í¬\n        if (\"Post\".equals(targetType)) {\n            Post post = postRepository.findById((Long) targetId).orElse(null);\n            return hasPermission(auth, post, permission);\n        }\n        return false;\n    }\n}\n\n// ì‚¬ìš© ì˜ˆì‹œ\n@PreAuthorize(\"hasPermission(#postId, 'Post', 'DELETE')\")\npublic void deletePost(Long postId) {\n    postRepository.deleteById(postId);\n}\n```"
            },
            {
                "type": "code",
                "title": "ğŸ›¡ï¸ ì‹¤ì „ ë³´ì•ˆ",
                "content": "### ê³„ì¸µí˜• ì—­í•  (Role Hierarchy)\n\n```java\n@Configuration\npublic class RoleHierarchyConfig {\n    \n    @Bean\n    public RoleHierarchy roleHierarchy() {\n        RoleHierarchyImpl hierarchy = new RoleHierarchyImpl();\n        // ADMIN > MANAGER > USER > GUEST\n        hierarchy.setHierarchy(\n            \"ROLE_ADMIN > ROLE_MANAGER\\n\" +\n            \"ROLE_MANAGER > ROLE_USER\\n\" +\n            \"ROLE_USER > ROLE_GUEST\"\n        );\n        return hierarchy;\n    }\n    \n    @Bean\n    public DefaultMethodSecurityExpressionHandler methodSecurityExpressionHandler(\n            RoleHierarchy roleHierarchy) {\n        DefaultMethodSecurityExpressionHandler handler = \n            new DefaultMethodSecurityExpressionHandler();\n        handler.setRoleHierarchy(roleHierarchy);\n        return handler;\n    }\n}\n```\n\n### ë™ì  ê¶Œí•œ ê´€ë¦¬ (DB ê¸°ë°˜)\n\n```java\n@Entity\n@Table(name = \"permissions\")\npublic class Permission {\n    @Id\n    private Long id;\n    private String name;  // POST_CREATE, POST_DELETE, etc.\n    private String description;\n}\n\n@Entity\n@Table(name = \"roles\")\npublic class Role {\n    @Id\n    private Long id;\n    private String name;  // ROLE_ADMIN, ROLE_USER\n    \n    @ManyToMany(fetch = FetchType.EAGER)\n    @JoinTable(name = \"role_permissions\")\n    private Set<Permission> permissions;\n}\n\n@Service\npublic class DynamicAuthorizationService {\n    \n    @Autowired\n    private RoleRepository roleRepository;\n    \n    // ëŸ°íƒ€ì„ì— ì—­í• ì— ê¶Œí•œ ì¶”ê°€\n    @Transactional\n    public void addPermissionToRole(String roleName, String permissionName) {\n        Role role = roleRepository.findByName(roleName).orElseThrow();\n        Permission permission = permissionRepository.findByName(permissionName).orElseThrow();\n        role.getPermissions().add(permission);\n        roleRepository.save(role);\n    }\n}\n```\n\n### IDOR(Insecure Direct Object Reference) ë°©ì§€\n\n```java\n@RestController\n@RequestMapping(\"/api/orders\")\npublic class OrderController {\n    \n    // âŒ ì·¨ì•½: ë‹¤ë¥¸ ì‚¬ìš©ì ì£¼ë¬¸ë„ ì¡°íšŒ ê°€ëŠ¥\n    @GetMapping(\"/{orderId}\")\n    public Order getOrderUnsafe(@PathVariable Long orderId) {\n        return orderRepository.findById(orderId).orElseThrow();\n    }\n    \n    // âœ… ì•ˆì „: ë³¸ì¸ ì£¼ë¬¸ë§Œ ì¡°íšŒ ê°€ëŠ¥\n    @GetMapping(\"/{orderId}\")\n    public Order getOrderSafe(\n            @PathVariable Long orderId,\n            @AuthenticationPrincipal User user) {\n        Order order = orderRepository.findById(orderId).orElseThrow();\n        \n        // ì†Œìœ ê¶Œ ê²€ì¦\n        if (!order.getUserId().equals(user.getId())) {\n            throw new AccessDeniedException(\"ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤\");\n        }\n        return order;\n    }\n    \n    // âœ… ë” ë‚˜ì€ ë°©ë²•: ì¿¼ë¦¬ì—ì„œ í•„í„°ë§\n    @GetMapping(\"/{orderId}\")\n    public Order getOrderBetter(\n            @PathVariable Long orderId,\n            @AuthenticationPrincipal User user) {\n        return orderRepository.findByIdAndUserId(orderId, user.getId())\n            .orElseThrow(() -> new ResourceNotFoundException(\"ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤\"));\n    }\n}\n```\n\n### API Rate Limiting\n\n```java\n@Aspect\n@Component\npublic class RateLimitAspect {\n    \n    private final Map<String, RateLimiter> limiters = new ConcurrentHashMap<>();\n    \n    @Around(\"@annotation(rateLimit)\")\n    public Object rateLimit(ProceedingJoinPoint pjp, RateLimit rateLimit) throws Throwable {\n        String key = getKey(pjp);\n        RateLimiter limiter = limiters.computeIfAbsent(key, \n            k -> RateLimiter.create(rateLimit.value()));\n        \n        if (!limiter.tryAcquire()) {\n            throw new TooManyRequestsException(\"ìš”ì²­ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤\");\n        }\n        return pjp.proceed();\n    }\n}\n\n@RateLimit(10)  // ì´ˆë‹¹ 10íšŒ ì œí•œ\n@GetMapping(\"/api/search\")\npublic List<Product> search(@RequestParam String query) {\n    return productService.search(query);\n}\n```"
            },
            {
                "type": "tip",
                "title": "ğŸ’¡ ì²´í¬ë¦¬ìŠ¤íŠ¸ & ë©´ì ‘",
                "content": "### ì‹¤ë¬´ ì²´í¬ë¦¬ìŠ¤íŠ¸\n\n```\n[ URL ê¶Œí•œ ]\nâ–¡ ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ ê¶Œí•œ ì„¤ì • í™•ì¸\nâ–¡ ê¸°ë³¸ê°’ì€ ì¸ì¦ í•„ìš” (.anyRequest().authenticated())\nâ–¡ ê´€ë¦¬ì URL íŒ¨í„´ ë¶„ë¦¬ (/admin/**, /api/admin/**)\nâ–¡ HTTP ë©”ì„œë“œë³„ ê¶Œí•œ ë¶„ë¦¬ (GET vs DELETE)\n\n[ ë©”ì„œë“œ ê¶Œí•œ ]\nâ–¡ ë¯¼ê°í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ @PreAuthorize ì ìš©\nâ–¡ ì†Œìœ ê¶Œ ê²€ì¦ ë¡œì§ (ë³¸ì¸ ë°ì´í„°ë§Œ ì ‘ê·¼)\nâ–¡ IDOR ì·¨ì•½ì  ì ê²€\n\n[ ì—­í• /ê¶Œí•œ ê´€ë¦¬ ]\nâ–¡ ìµœì†Œ ê¶Œí•œ ì›ì¹™ ì ìš©\nâ–¡ ì—­í•  ê³„ì¸µ êµ¬ì¡° ì •ì˜\nâ–¡ ì •ê¸°ì ì¸ ê¶Œí•œ ê²€í†  (ë¶„ê¸°ë³„)\n\n[ ë¡œê¹…/ê°ì‚¬ ]\nâ–¡ ê¶Œí•œ ê±°ë¶€ ì´ë²¤íŠ¸ ë¡œê¹…\nâ–¡ ê´€ë¦¬ì ì‘ì—… ê°ì‚¬ ë¡œê·¸\nâ–¡ ë¹„ì •ìƒ ì ‘ê·¼ íŒ¨í„´ ëª¨ë‹ˆí„°ë§\n```\n\n---\n\n### ë©´ì ‘ ì˜ˆìƒ ì§ˆë¬¸\n\n```\nğŸ‘¶ ì£¼ë‹ˆì–´ ë ˆë²¨:\n\nQ: ì¸ì¦ê³¼ ì¸ê°€ì˜ ì°¨ì´ì ì€?\nA: ì¸ì¦ì€ \"ëˆ„êµ¬ì¸ê°€\" í™•ì¸ (ë¡œê·¸ì¸), ì¸ê°€ëŠ” \"ë¬´ì—‡ì„ í•  ìˆ˜ ìˆëŠ”ê°€\" í™•ì¸ (ê¶Œí•œ ì²´í¬)\n\nQ: RBACë€ ë¬´ì—‡ì¸ê°€ìš”?\nA: Role-Based Access Control, ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´.\n   ì‚¬ìš©ìì—ê²Œ ì—­í•  ë¶€ì—¬, ì—­í• ì— ê¶Œí•œ ë¶€ì—¬í•˜ëŠ” ë°©ì‹.\n\nQ: @PreAuthorizeì™€ @Securedì˜ ì°¨ì´ëŠ”?\nA: @SecuredëŠ” ì—­í• ë§Œ ì§€ì • ê°€ëŠ¥, @PreAuthorizeëŠ” SpEL í‘œí˜„ì‹ìœ¼ë¡œ ë³µì¡í•œ ì¡°ê±´ ê°€ëŠ¥.\n   @PreAuthorize(\"#userId == authentication.principal.id\") ê°™ì€ íŒŒë¼ë¯¸í„° ë¹„êµ ê°€ëŠ¥.\n\nğŸ‘¨â€ğŸ’¼ ì‹œë‹ˆì–´ ë ˆë²¨:\n\nQ: IDOR ì·¨ì•½ì ê³¼ ë°©ì–´ ë°©ë²•ì€?\nA: Insecure Direct Object Reference, URLì˜ IDë¥¼ ë³€ê²½í•´ ë‹¤ë¥¸ ì‚¬ìš©ì ë°ì´í„° ì ‘ê·¼.\n   ë°©ì–´: ëª¨ë“  ë°ì´í„° ì ‘ê·¼ ì‹œ ì†Œìœ ê¶Œ ê²€ì¦, ì¿¼ë¦¬ì—ì„œ userId í•„í„°ë§.\n\nQ: ABACë¥¼ ì„ íƒí•´ì•¼ í•˜ëŠ” ìƒí™©ì€?\nA: ì¡°ê±´ì´ ë³µì¡í•  ë•Œ (ì‹œê°„, ìœ„ì¹˜, ë¶€ì„œ, ë°ì´í„° ë¶„ë¥˜ ë“± ë‹¤ì¤‘ ì†ì„± ê¸°ë°˜),\n   ì •ì±…ì´ ìì£¼ ë³€ê²½ë  ë•Œ, ì„¸ë°€í•œ ë™ì  ì œì–´ê°€ í•„ìš”í•  ë•Œ.\n\nQ: ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì—ì„œ ì¸ê°€ ì²˜ë¦¬ ë°©ë²•ì€?\nA: API Gatewayì—ì„œ 1ì°¨ ì¸ê°€, ê° ì„œë¹„ìŠ¤ì—ì„œ ì„¸ë¶€ ì¸ê°€.\n   ë˜ëŠ” ì‚¬ì´ë“œì¹´ íŒ¨í„´(Envoy + OPA), Policy Decision Point ì¤‘ì•™í™”.\n```\n\n---\n\n### ê¶Œí•œ ì„¤ê³„ ì˜ˆì‹œ\n\n```\n[ROLE_ADMIN]\nâ”œâ”€â”€ USER_CREATE, USER_READ, USER_UPDATE, USER_DELETE\nâ”œâ”€â”€ POST_CREATE, POST_READ, POST_UPDATE, POST_DELETE\nâ””â”€â”€ SYSTEM_CONFIG\n\n[ROLE_MANAGER]\nâ”œâ”€â”€ USER_READ\nâ”œâ”€â”€ POST_CREATE, POST_READ, POST_UPDATE, POST_DELETE\nâ””â”€â”€ REPORT_VIEW\n\n[ROLE_USER]\nâ”œâ”€â”€ POST_CREATE, POST_READ\nâ””â”€â”€ POST_UPDATE (own), POST_DELETE (own)\n```"
            }
        ]
    }


def get_password_security_content():
    """ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆ (BCrypt) content"""
    return {
        "id": "03_ì¸ì¦/password-security",
        "title": "ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆ (BCrypt)",
        "category": "security",
        "subCategory": "03_ì¸ì¦",
        "language": "Java",
        "description": "ì•ˆì „í•œ ë¹„ë°€ë²ˆí˜¸ ì €ì¥ ë°©ë²•, BCrypt/Argon2 í•´ì‹œ ì•Œê³ ë¦¬ì¦˜, ë¹„ë°€ë²ˆí˜¸ ì •ì±…ì„ í•™ìŠµí•©ë‹ˆë‹¤.",
        "isPlaceholder": False,
        "sections": [
            {
                "type": "concept",
                "title": "ğŸ” ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆ (BCrypt) ì™„ì „ ì •ë³µ",
                "content": "## í•œ ì¤„ ìš”ì•½\n> **ë¹„ë°€ë²ˆí˜¸ëŠ” ì ˆëŒ€ í‰ë¬¸ ì €ì¥ ê¸ˆì§€!** - BCryptë¡œ í•´ì‹œí•˜ì—¬ ìœ ì¶œë˜ì–´ë„ ì›ë³¸ ë³µì› ë¶ˆê°€ëŠ¥í•˜ê²Œ!\n\n---\n\n## ğŸ’¡ ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°\n\n```\nğŸ¥© ê³ ê¸° ë¶„ì‡„ê¸°ì— ë¹„ìœ í•˜ë©´:\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚         ğŸ” ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ ê³¼ì •            â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                         â”‚\nâ”‚   \"password123\"                         â”‚\nâ”‚        â†“                                â”‚\nâ”‚   ğŸ”„ BCrypt ë¶„ì‡„ê¸° (+ ì†Œê¸ˆ)              â”‚\nâ”‚        â†“                                â”‚\nâ”‚   \"$2a$12$K4fG...\" (60ì í•´ì‹œ)          â”‚\nâ”‚                                         â”‚\nâ”‚   íŠ¹ì§•:                                  â”‚\nâ”‚   â€¢ ë¶„ì‡„ëœ ê³ ê¸°ë¡œ ì›ë˜ ëª¨ì–‘ ë³µì› ë¶ˆê°€     â”‚\nâ”‚   â€¢ ê°™ì€ ê³ ê¸°ë„ ì†Œê¸ˆ ì–‘ì— ë”°ë¼ ë§› ë‹¤ë¦„    â”‚\nâ”‚   â€¢ ë¶„ì‡„ ì‹œê°„ì„ ì¡°ì ˆ ê°€ëŠ¥ (cost factor)  â”‚\nâ”‚                                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## ğŸ”„ í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ ë¹„êµ\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚               ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ ë¹„êµ                 â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                         â”‚\nâ”‚   âŒ MD5, SHA-1, SHA-256 (ë‹¨ë… ì‚¬ìš© ê¸ˆì§€)                â”‚\nâ”‚   â€¢ ë¹ ë¥¸ ì—°ì‚° â†’ ë¸Œë£¨íŠ¸í¬ìŠ¤ì— ì·¨ì•½                        â”‚\nâ”‚   â€¢ ì†”íŠ¸ ì—†ìŒ â†’ ë ˆì¸ë³´ìš° í…Œì´ë¸” ê³µê²©                     â”‚\nâ”‚   â€¢ GPUë¡œ ì´ˆë‹¹ ìˆ˜ì‹­ì–µ ê°œ í•´ì‹œ ê°€ëŠ¥                       â”‚\nâ”‚                                                         â”‚\nâ”‚   âœ… BCrypt (ê¶Œì¥)                                       â”‚\nâ”‚   â€¢ ì˜ë„ì ìœ¼ë¡œ ëŠë¦¼ (cost factorë¡œ ì¡°ì ˆ)                 â”‚\nâ”‚   â€¢ ì†”íŠ¸ ìë™ ìƒì„± ë° í¬í•¨                               â”‚\nâ”‚   â€¢ 22ì ì†”íŠ¸ + 31ì í•´ì‹œ = 60ì ì¶œë ¥                    â”‚\nâ”‚                                                         â”‚\nâ”‚   âœ… Argon2 (ë” ê¶Œì¥, 2015 PHC ìš°ìŠ¹)                     â”‚\nâ”‚   â€¢ ë©”ëª¨ë¦¬ ì§‘ì•½ì  â†’ GPU ê³µê²© ë°©ì–´                        â”‚\nâ”‚   â€¢ ì‹œê°„, ë©”ëª¨ë¦¬, ë³‘ë ¬ì„± ì¡°ì ˆ ê°€ëŠ¥                       â”‚\nâ”‚   â€¢ ìµœì‹  ì‹œìŠ¤í…œì— ê¶Œì¥                                   â”‚\nâ”‚                                                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n| ì•Œê³ ë¦¬ì¦˜ | ì†ë„ | ì†”íŠ¸ | GPU ì €í•­ | ê¶Œì¥ |\n|----------|------|------|----------|------|\n| MD5 | ë§¤ìš° ë¹ ë¦„ | X | X | âŒ ê¸ˆì§€ |\n| SHA-256 | ë§¤ìš° ë¹ ë¦„ | X | X | âŒ ê¸ˆì§€ |\n| BCrypt | ëŠë¦¼ (ì¡°ì ˆ) | O | O | âœ… ê¶Œì¥ |\n| Argon2 | ëŠë¦¼ (ì¡°ì ˆ) | O | O | âœ… ìµœê³  |\n| PBKDF2 | ëŠë¦¼ (ì¡°ì ˆ) | O | â–³ | âœ… ê°€ëŠ¥ |\n\n---\n\n## ğŸš¨ ì‹¤ì œ ì‚¬ê³  ì‚¬ë¡€\n\n```\nğŸ“Œ 2012ë…„ LinkedIn í•´í‚¹\nì›ì¸: SHA-1 ë‹¨ë… ì‚¬ìš©, ì†”íŠ¸ ì—†ìŒ\ní”¼í•´: 650ë§Œ ê°œ ë¹„ë°€ë²ˆí˜¸ ì¦‰ì‹œ ë³µí˜¸í™”\nêµí›ˆ: ë°˜ë“œì‹œ ì†”íŠ¸ + ëŠë¦° í•´ì‹œ ì‚¬ìš©\n\nğŸ“Œ 2016ë…„ Yahoo í•´í‚¹\nì›ì¸: MD5 í•´ì‹œ ì‚¬ìš©\ní”¼í•´: 30ì–µ ê³„ì • ìœ ì¶œ, ì—­ëŒ€ ìµœëŒ€\nêµí›ˆ: MD5ëŠ” ë¹„ë°€ë²ˆí˜¸ì— ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€\n\nğŸ“Œ 2019ë…„ Facebook í‰ë¬¸ ì €ì¥\nì›ì¸: ë‚´ë¶€ ë¡œê·¸ì— ë¹„ë°€ë²ˆí˜¸ í‰ë¬¸ ì €ì¥\ní”¼í•´: 6ì–µ ê°œ ë¹„ë°€ë²ˆí˜¸ ë…¸ì¶œ\nêµí›ˆ: ë¡œê¹… ì‹œì—ë„ ë§ˆìŠ¤í‚¹ í•„ìˆ˜\n```\n\n### BCrypt í•´ì‹œ êµ¬ì¡°\n```\n$2a$12$K4fG8pS2n3mJ5kL7qR9tYeW1vX3zB6cN8mP0oI2uA4sD5gH7jK9lM\n â”‚â”‚  â”‚â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n â”‚â”‚  â”‚â”‚                          í•´ì‹œê°’ (31ì)\n â”‚â”‚  â”‚â””â”€â”€ ì†”íŠ¸ (22ì)\n â”‚â”‚  â””â”€â”€â”€ Cost Factor (12 = 2^12ë²ˆ ë°˜ë³µ)\n â”‚â””â”€â”€â”€â”€â”€â”€ ë²„ì „ (2a, 2b, 2y)\n â””â”€â”€â”€â”€â”€â”€â”€ ì•Œê³ ë¦¬ì¦˜ ì‹ë³„ì\n```"
            },
            {
                "type": "code",
                "title": "ğŸ’» êµ¬í˜„ ì½”ë“œ",
                "content": "### Spring Security BCrypt ì„¤ì •\n\n```java\n@Configuration\npublic class PasswordConfig {\n    \n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        // cost factor 12 ê¶Œì¥ (10~14 ì‚¬ì´ ì¡°ì ˆ)\n        // 12 = ì•½ 0.3ì´ˆ, 14 = ì•½ 1ì´ˆ (ì„œë²„ ì„±ëŠ¥ì— ë”°ë¼)\n        return new BCryptPasswordEncoder(12);\n    }\n}\n```\n\n### íšŒì›ê°€ì… ì‹œ ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ\n\n```java\n@Service\n@RequiredArgsConstructor\npublic class UserService {\n    \n    private final UserRepository userRepository;\n    private final PasswordEncoder passwordEncoder;\n    \n    public User register(UserRegisterRequest request) {\n        // ë¹„ë°€ë²ˆí˜¸ ì •ì±… ê²€ì¦\n        validatePassword(request.getPassword());\n        \n        // BCryptë¡œ í•´ì‹œ\n        String hashedPassword = passwordEncoder.encode(request.getPassword());\n        \n        User user = User.builder()\n            .email(request.getEmail())\n            .password(hashedPassword)  // í•´ì‹œëœ ë¹„ë°€ë²ˆí˜¸ ì €ì¥\n            .build();\n        \n        return userRepository.save(user);\n    }\n    \n    // ë¹„ë°€ë²ˆí˜¸ ì •ì±… ê²€ì¦\n    private void validatePassword(String password) {\n        if (password.length() < 8) {\n            throw new InvalidPasswordException(\"ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤\");\n        }\n        if (!password.matches(\".*[A-Z].*\")) {\n            throw new InvalidPasswordException(\"ëŒ€ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤\");\n        }\n        if (!password.matches(\".*[a-z].*\")) {\n            throw new InvalidPasswordException(\"ì†Œë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤\");\n        }\n        if (!password.matches(\".*[0-9].*\")) {\n            throw new InvalidPasswordException(\"ìˆ«ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤\");\n        }\n        if (!password.matches(\".*[!@#$%^&*].*\")) {\n            throw new InvalidPasswordException(\"íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤\");\n        }\n    }\n}\n```\n\n### ë¡œê·¸ì¸ ì‹œ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦\n\n```java\n@Service\n@RequiredArgsConstructor\npublic class AuthService {\n    \n    private final UserRepository userRepository;\n    private final PasswordEncoder passwordEncoder;\n    \n    public User login(String email, String rawPassword) {\n        User user = userRepository.findByEmail(email)\n            .orElseThrow(() -> new AuthException(\"ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤\"));\n        \n        // BCrypt í•´ì‹œ ë¹„êµ\n        if (!passwordEncoder.matches(rawPassword, user.getPassword())) {\n            // ë¡œê·¸ì¸ ì‹¤íŒ¨ íšŸìˆ˜ ì¦ê°€\n            incrementFailedAttempts(user);\n            throw new AuthException(\"ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤\");\n        }\n        \n        // ê³„ì • ì ê¸ˆ í™•ì¸\n        if (user.isLocked()) {\n            throw new AuthException(\"ê³„ì •ì´ ì ê²¼ìŠµë‹ˆë‹¤. 30ë¶„ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”\");\n        }\n        \n        // ë¡œê·¸ì¸ ì„±ê³µ - ì‹¤íŒ¨ íšŸìˆ˜ ì´ˆê¸°í™”\n        resetFailedAttempts(user);\n        return user;\n    }\n    \n    private void incrementFailedAttempts(User user) {\n        user.setFailedAttempts(user.getFailedAttempts() + 1);\n        if (user.getFailedAttempts() >= 5) {\n            user.setLockTime(LocalDateTime.now());\n        }\n        userRepository.save(user);\n    }\n}\n```\n\n### Argon2 ì‚¬ìš© (ë” ê°•ë ¥í•œ í•´ì‹œ)\n\n```java\n// build.gradle\n// implementation 'org.bouncycastle:bcprov-jdk15on:1.70'\n\n@Configuration\npublic class Argon2Config {\n    \n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        return new Argon2PasswordEncoder(\n            16,      // saltLength\n            32,      // hashLength\n            1,       // parallelism\n            65536,   // memory (64MB)\n            3        // iterations\n        );\n    }\n}\n```"
            },
            {
                "type": "code",
                "title": "ğŸ›¡ï¸ ì‹¤ì „ ë³´ì•ˆ",
                "content": "### ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ë° ì´ë ¥ ê´€ë¦¬\n\n```java\n@Service\n@RequiredArgsConstructor\npublic class PasswordService {\n    \n    private final PasswordEncoder passwordEncoder;\n    private final PasswordHistoryRepository historyRepository;\n    \n    @Transactional\n    public void changePassword(User user, String currentPassword, String newPassword) {\n        // 1. í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ í™•ì¸\n        if (!passwordEncoder.matches(currentPassword, user.getPassword())) {\n            throw new InvalidPasswordException(\"í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤\");\n        }\n        \n        // 2. ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì •ì±… ê²€ì¦\n        validatePassword(newPassword);\n        \n        // 3. ì´ì „ ë¹„ë°€ë²ˆí˜¸ì™€ ë™ì¼í•œì§€ í™•ì¸ (ìµœê·¼ 5ê°œ)\n        List<PasswordHistory> history = historyRepository\n            .findTop5ByUserIdOrderByCreatedAtDesc(user.getId());\n        \n        for (PasswordHistory ph : history) {\n            if (passwordEncoder.matches(newPassword, ph.getPasswordHash())) {\n                throw new InvalidPasswordException(\"ìµœê·¼ 5íšŒ ì´ë‚´ ì‚¬ìš©í•œ ë¹„ë°€ë²ˆí˜¸ëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤\");\n            }\n        }\n        \n        // 4. ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ë° ì´ë ¥ ì €ì¥\n        String newHash = passwordEncoder.encode(newPassword);\n        \n        historyRepository.save(PasswordHistory.builder()\n            .userId(user.getId())\n            .passwordHash(user.getPassword())\n            .build());\n        \n        user.setPassword(newHash);\n        user.setPasswordChangedAt(LocalDateTime.now());\n        userRepository.save(user);\n    }\n}\n```\n\n### ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • (í† í° ê¸°ë°˜)\n\n```java\n@Service\n@RequiredArgsConstructor\npublic class PasswordResetService {\n    \n    private final UserRepository userRepository;\n    private final PasswordResetTokenRepository tokenRepository;\n    private final EmailService emailService;\n    \n    // ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ìš”ì²­\n    public void requestPasswordReset(String email) {\n        User user = userRepository.findByEmail(email)\n            .orElse(null);\n        \n        // ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì´ë©”ì¼ì´ì–´ë„ ê°™ì€ ì‘ë‹µ (ì´ë©”ì¼ ì—´ê±° ë°©ì§€)\n        if (user == null) {\n            return;\n        }\n        \n        // ê¸°ì¡´ í† í° ì‚­ì œ\n        tokenRepository.deleteByUserId(user.getId());\n        \n        // ìƒˆ í† í° ìƒì„± (32ë°”ì´íŠ¸ ëœë¤)\n        String token = generateSecureToken();\n        \n        PasswordResetToken resetToken = PasswordResetToken.builder()\n            .token(hashToken(token))  // í† í°ë„ í•´ì‹œí•´ì„œ ì €ì¥\n            .userId(user.getId())\n            .expiresAt(LocalDateTime.now().plusHours(1))  // 1ì‹œê°„ ìœ íš¨\n            .build();\n        tokenRepository.save(resetToken);\n        \n        // ì´ë©”ì¼ ë°œì†¡ (ì›ë³¸ í† í°)\n        emailService.sendPasswordResetEmail(email, token);\n    }\n    \n    // ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì‹¤í–‰\n    @Transactional\n    public void resetPassword(String token, String newPassword) {\n        String hashedToken = hashToken(token);\n        \n        PasswordResetToken resetToken = tokenRepository.findByToken(hashedToken)\n            .orElseThrow(() -> new InvalidTokenException(\"ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì…ë‹ˆë‹¤\"));\n        \n        if (resetToken.getExpiresAt().isBefore(LocalDateTime.now())) {\n            tokenRepository.delete(resetToken);\n            throw new InvalidTokenException(\"í† í°ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤\");\n        }\n        \n        User user = userRepository.findById(resetToken.getUserId()).orElseThrow();\n        user.setPassword(passwordEncoder.encode(newPassword));\n        userRepository.save(user);\n        \n        // ì‚¬ìš©ëœ í† í° ì‚­ì œ\n        tokenRepository.delete(resetToken);\n    }\n    \n    private String generateSecureToken() {\n        byte[] bytes = new byte[32];\n        new SecureRandom().nextBytes(bytes);\n        return Base64.getUrlEncoder().withoutPadding().encodeToString(bytes);\n    }\n    \n    private String hashToken(String token) {\n        return DigestUtils.sha256Hex(token);\n    }\n}\n```\n\n### ë¹„ë°€ë²ˆí˜¸ ìœ ì¶œ í™•ì¸ (Have I Been Pwned)\n\n```java\n@Service\npublic class PasswordBreachService {\n    \n    private final RestTemplate restTemplate = new RestTemplate();\n    \n    // Have I Been Pwned APIë¡œ ìœ ì¶œ ì—¬ë¶€ í™•ì¸ (k-Anonymity)\n    public boolean isPasswordBreached(String password) {\n        String sha1Hash = DigestUtils.sha1Hex(password).toUpperCase();\n        String prefix = sha1Hash.substring(0, 5);\n        String suffix = sha1Hash.substring(5);\n        \n        // APIëŠ” í•´ì‹œ ì• 5ìë¦¬ë§Œ ì „ì†¡ (ì›ë³¸ ë¹„ë°€ë²ˆí˜¸ ë…¸ì¶œ ì•ˆ í•¨)\n        String url = \"https://api.pwnedpasswords.com/range/\" + prefix;\n        String response = restTemplate.getForObject(url, String.class);\n        \n        // ì‘ë‹µì—ì„œ ë‚˜ë¨¸ì§€ í•´ì‹œ ê²€ìƒ‰\n        return response != null && response.contains(suffix);\n    }\n}\n\n// ì‚¬ìš© ì˜ˆì‹œ\npublic void register(String password) {\n    if (breachService.isPasswordBreached(password)) {\n        throw new InvalidPasswordException(\n            \"ì´ ë¹„ë°€ë²ˆí˜¸ëŠ” ìœ ì¶œëœ ë¹„ë°€ë²ˆí˜¸ ëª©ë¡ì— ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.\");\n    }\n}\n```"
            },
            {
                "type": "tip",
                "title": "ğŸ’¡ ì²´í¬ë¦¬ìŠ¤íŠ¸ & ë©´ì ‘",
                "content": "### ì‹¤ë¬´ ì²´í¬ë¦¬ìŠ¤íŠ¸\n\n```\n[ í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ ]\nâ–¡ BCrypt (cost 12+) ë˜ëŠ” Argon2 ì‚¬ìš©\nâ–¡ MD5, SHA ë‹¨ë… ì‚¬ìš© ì ˆëŒ€ ê¸ˆì§€\nâ–¡ ì†”íŠ¸ ìë™ ìƒì„± í™•ì¸\n\n[ ë¹„ë°€ë²ˆí˜¸ ì •ì±… ]\nâ–¡ ìµœì†Œ 8ì ì´ìƒ\nâ–¡ ëŒ€ë¬¸ì, ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì ì¡°í•©\nâ–¡ ì—°ì† ë¬¸ì ê¸ˆì§€ (1234, abcd)\nâ–¡ ê°œì¸ì •ë³´ í¬í•¨ ê¸ˆì§€ (ì´ë¦„, ìƒë…„ì›”ì¼)\nâ–¡ ì´ì „ ë¹„ë°€ë²ˆí˜¸ ì¬ì‚¬ìš© ì œí•œ (ìµœê·¼ 5ê°œ)\n\n[ ê³„ì • ë³´í˜¸ ]\nâ–¡ ë¡œê·¸ì¸ ì‹¤íŒ¨ 5íšŒ ì‹œ 30ë¶„ ì ê¸ˆ\nâ–¡ ë¹„ë°€ë²ˆí˜¸ 90ì¼ ì£¼ê¸° ë³€ê²½ ê¶Œì¥\nâ–¡ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í† í° 1ì‹œê°„ ë§Œë£Œ\nâ–¡ ì¬ì„¤ì • í† í°ë„ í•´ì‹œ ì €ì¥\n\n[ ë¡œê¹… ]\nâ–¡ ë¹„ë°€ë²ˆí˜¸ í‰ë¬¸ ë¡œê¹… ì ˆëŒ€ ê¸ˆì§€\nâ–¡ ë¡œê·¸ì¸ ì‹œë„ ê¸°ë¡ (IP, ì‹œê°„, ì„±ê³µ/ì‹¤íŒ¨)\n```\n\n---\n\n### ë©´ì ‘ ì˜ˆìƒ ì§ˆë¬¸\n\n```\nğŸ‘¶ ì£¼ë‹ˆì–´ ë ˆë²¨:\n\nQ: ë¹„ë°€ë²ˆí˜¸ë¥¼ ì™œ í•´ì‹œí•´ì„œ ì €ì¥í•˜ë‚˜ìš”?\nA: í‰ë¬¸ ì €ì¥ ì‹œ DB ìœ ì¶œë˜ë©´ ëª¨ë“  ë¹„ë°€ë²ˆí˜¸ ë…¸ì¶œ.\n   í•´ì‹œëŠ” ë‹¨ë°©í–¥ì´ë¼ ì›ë³¸ ë³µì› ë¶ˆê°€.\n\nQ: BCryptì˜ íŠ¹ì§•ì€?\nA: ëŠë¦° í•´ì‹œ(cost factorë¡œ ì¡°ì ˆ), ì†”íŠ¸ ìë™ ìƒì„±/í¬í•¨,\n   GPU ë¸Œë£¨íŠ¸í¬ìŠ¤ì— ê°•í•¨.\n\nQ: ì†”íŠ¸(Salt)ì˜ ì—­í• ì€?\nA: ê°™ì€ ë¹„ë°€ë²ˆí˜¸ë„ ë‹¤ë¥¸ í•´ì‹œê°’ ìƒì„± â†’ ë ˆì¸ë³´ìš° í…Œì´ë¸” ê³µê²© ë°©ì§€.\n\nğŸ‘¨â€ğŸ’¼ ì‹œë‹ˆì–´ ë ˆë²¨:\n\nQ: BCrypt cost factorëŠ” ì–´ë–»ê²Œ ê²°ì •í•˜ë‚˜ìš”?\nA: ì„œë²„ ì„±ëŠ¥ì— ë”°ë¼ ë¡œê·¸ì¸ ì‘ë‹µ ì‹œê°„ 0.1~0.3ì´ˆ ìœ ì§€ ê°€ëŠ¥í•œ ê°’.\n   ë³´í†µ 10~14, í•˜ë“œì›¨ì–´ ë°œì „ì— ë”°ë¼ ì£¼ê¸°ì  ì¦ê°€.\n\nQ: Argon2ê°€ BCryptë³´ë‹¤ ë‚˜ì€ ì´ìœ ëŠ”?\nA: ë©”ëª¨ë¦¬ ì§‘ì•½ì ì´ë¼ GPU/ASIC ê³µê²©ì— ë” ê°•í•¨.\n   ì‹œê°„, ë©”ëª¨ë¦¬, ë³‘ë ¬ì„± 3ê°€ì§€ íŒŒë¼ë¯¸í„°ë¡œ ì„¸ë°€í•œ ì¡°ì ˆ ê°€ëŠ¥.\n\nQ: ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ ì—…ê·¸ë ˆì´ë“œëŠ” ì–´ë–»ê²Œ í•˜ë‚˜ìš”?\nA: ì‚¬ìš©ì ë¡œê·¸ì¸ ì‹œ í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ ì•Œ ìˆ˜ ìˆìœ¼ë¯€ë¡œ,\n   ê²€ì¦ ì„±ê³µ í›„ ìƒˆ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ì¬í•´ì‹œí•˜ì—¬ ì €ì¥.\n```\n\n---\n\n### Cost Factor ì°¸ê³ í‘œ\n\n```\nCost â”‚ ëŒ€ëµ ì‹œê°„ â”‚ ê¶Œì¥ ìš©ë„\nâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n 10  â”‚ ~0.1ì´ˆ   â”‚ ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½\n 11  â”‚ ~0.15ì´ˆ  â”‚ ì¼ë°˜ ì›¹ ì„œë¹„ìŠ¤\n 12  â”‚ ~0.3ì´ˆ   â”‚ ê¶Œì¥ (2024ë…„ ê¸°ì¤€)\n 13  â”‚ ~0.5ì´ˆ   â”‚ ê³ ë³´ì•ˆ ì„œë¹„ìŠ¤\n 14  â”‚ ~1ì´ˆ     â”‚ ê¸ˆìœµ/ì˜ë£Œ ì„œë¹„ìŠ¤\n```"
            }
        ]
    }


def get_mfa_content():
    """ë‹¤ì¤‘ ì¸ì¦ (MFA/2FA) content"""
    return {
        "id": "03_ì¸ì¦/mfa",
        "title": "ë‹¤ì¤‘ ì¸ì¦ (MFA/2FA)",
        "category": "security",
        "subCategory": "03_ì¸ì¦",
        "language": "Java",
        "description": "ë‹¤ì¤‘ ì¸ì¦ì˜ ê°œë…, TOTP/SMS/ì´ë©”ì¼ ì¸ì¦ êµ¬í˜„, Google Authenticator ì—°ë™ì„ í•™ìŠµí•©ë‹ˆë‹¤.",
        "isPlaceholder": False,
        "sections": [
            {
                "type": "concept",
                "title": "ğŸ” ë‹¤ì¤‘ ì¸ì¦ (MFA/2FA) ì™„ì „ ì •ë³µ",
                "content": "## í•œ ì¤„ ìš”ì•½\n> **ë¹„ë°€ë²ˆí˜¸ë§Œìœ¼ë¡  ë¶€ì¡±í•˜ë‹¤!** - 2ê°œ ì´ìƒì˜ ì¸ì¦ ìš”ì†Œë¥¼ ì¡°í•©í•˜ì—¬ ë³´ì•ˆ ê°•í™”!\n\n---\n\n## ğŸ’¡ ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°\n\n```\nğŸ¦ ì€í–‰ ê¸ˆê³ ì— ë¹„ìœ í•˜ë©´:\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚           ğŸ” ë‹¤ì¤‘ ì¸ì¦ (MFA)             â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                         â”‚\nâ”‚   1ë‹¨ê³„: ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (ì§€ì‹ ìš”ì†Œ)        â”‚\nâ”‚       \"ë‚´ê°€ ì•„ëŠ” ê²ƒ\"                     â”‚\nâ”‚              â†“                          â”‚\nâ”‚   2ë‹¨ê³„: OTP ì…ë ¥ (ì†Œìœ  ìš”ì†Œ)            â”‚\nâ”‚       \"ë‚´ê°€ ê°€ì§„ ê²ƒ\" (íœ´ëŒ€í°)             â”‚\nâ”‚              â†“                          â”‚\nâ”‚   (ì„ íƒ) ì§€ë¬¸ ì¸ì‹ (ìƒì²´ ìš”ì†Œ)            â”‚\nâ”‚       \"ë‚˜ ìì‹ \"                          â”‚\nâ”‚              â†“                          â”‚\nâ”‚   âœ… ëª¨ë“  ë‹¨ê³„ í†µê³¼ â†’ ë¡œê·¸ì¸ ì„±ê³µ         â”‚\nâ”‚                                         â”‚\nâ”‚   í•´ì»¤ê°€ ë¹„ë°€ë²ˆí˜¸ íƒˆì·¨í•´ë„,               â”‚\nâ”‚   íœ´ëŒ€í° ì—†ìœ¼ë©´ ë¡œê·¸ì¸ ë¶ˆê°€! ğŸ“±          â”‚\nâ”‚                                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## ğŸ”„ ì¸ì¦ ìš”ì†Œ ë¹„êµ\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                   3ê°€ì§€ ì¸ì¦ ìš”ì†Œ                        â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                         â”‚\nâ”‚   ğŸ§  ì§€ì‹ (Something You Know)                          â”‚\nâ”‚   â€¢ ë¹„ë°€ë²ˆí˜¸, PIN, ë³´ì•ˆ ì§ˆë¬¸                             â”‚\nâ”‚   â€¢ ìœ„í—˜: í”¼ì‹±, ìœ ì¶”, ìœ ì¶œ                               â”‚\nâ”‚                                                         â”‚\nâ”‚   ğŸ“± ì†Œìœ  (Something You Have)                          â”‚\nâ”‚   â€¢ íœ´ëŒ€í°(OTP), ë³´ì•ˆí‚¤(YubiKey), ìŠ¤ë§ˆíŠ¸ì¹´ë“œ             â”‚\nâ”‚   â€¢ ìœ„í—˜: ë¶„ì‹¤, ë„ë‚œ, SIM ìŠ¤ì™€í•‘                         â”‚\nâ”‚                                                         â”‚\nâ”‚   ğŸ‘† ìƒì²´ (Something You Are)                           â”‚\nâ”‚   â€¢ ì§€ë¬¸, ì•ˆë©´ì¸ì‹, í™ì±„, ìŒì„±                           â”‚\nâ”‚   â€¢ ìœ„í—˜: ë³µì œ ê°€ëŠ¥, ë³€ê²½ ë¶ˆê°€                           â”‚\nâ”‚                                                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n| MFA ë°©ì‹ | ë³´ì•ˆì„± | í¸ì˜ì„± | ë¹„ìš© | ê¶Œì¥ |\n|----------|--------|--------|------|------|\n| SMS OTP | ë‚®ìŒ | ë†’ìŒ | ì¤‘ê°„ | âš ï¸ ë¹„ê¶Œì¥ |\n| Email OTP | ë‚®ìŒ | ë†’ìŒ | ë‚®ìŒ | âš ï¸ ë¹„ê¶Œì¥ |\n| TOTP (ì•±) | ë†’ìŒ | ì¤‘ê°„ | ë‚®ìŒ | âœ… ê¶Œì¥ |\n| í•˜ë“œì›¨ì–´ í‚¤ | ë§¤ìš° ë†’ìŒ | ë‚®ìŒ | ë†’ìŒ | âœ… ìµœê³  |\n| Push ì•Œë¦¼ | ë†’ìŒ | ë†’ìŒ | ì¤‘ê°„ | âœ… ê¶Œì¥ |\n\n---\n\n## ğŸš¨ ì‹¤ì œ ì‚¬ê³  ì‚¬ë¡€\n\n```\nğŸ“Œ 2020ë…„ Twitter í•´í‚¹ (SIM Swapping)\nì›ì¸: SMS ê¸°ë°˜ 2FA, í†µì‹ ì‚¬ ì§ì› ë§¤ìˆ˜ë¡œ SIM íƒˆì·¨\ní”¼í•´: ë²„ë½ ì˜¤ë°”ë§ˆ, ì¼ë¡  ë¨¸ìŠ¤í¬ ë“± VIP ê³„ì • í•´í‚¹\nêµí›ˆ: SMS 2FAëŠ” ì·¨ì•½, TOTP ë˜ëŠ” í•˜ë“œì›¨ì–´ í‚¤ ê¶Œì¥\n\nğŸ“Œ 2022ë…„ Uber í•´í‚¹ (MFA í”¼ë¡œ ê³µê²©)\nì›ì¸: ë°˜ë³µì  í‘¸ì‹œ ì•Œë¦¼ìœ¼ë¡œ ì‚¬ìš©ì ì‹¤ìˆ˜ ìœ ë„\ní”¼í•´: ë‚´ë¶€ ì‹œìŠ¤í…œ ì „ì²´ ì ‘ê·¼\nêµí›ˆ: ìˆ«ì ë§¤ì¹­ ë°©ì‹ ë„ì…, ìš”ì²­ ì œí•œ í•„ìš”\n\nğŸ“Œ 2023ë…„ Reddit í•´í‚¹ (í”¼ì‹± + MFA ìš°íšŒ)\nì›ì¸: ì§ì› ëŒ€ìƒ í”¼ì‹±ìœ¼ë¡œ MFA ì½”ë“œê¹Œì§€ íƒˆì·¨\ní”¼í•´: ë‚´ë¶€ ë¬¸ì„œ, ì†ŒìŠ¤ì½”ë“œ ì¼ë¶€ ìœ ì¶œ\nêµí›ˆ: í”¼ì‹± ì €í•­ì„± ë†’ì€ FIDO2 í‚¤ ë„ì… í•„ìš”\n```\n\n### TOTP ë™ì‘ ì›ë¦¬\n```\n[ì„œë²„]              [ì•± (Google Authenticator)]\n   â”‚                        â”‚\n   â”‚   Secret Key ê³µìœ        â”‚\n   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚\n   â”‚   (QRì½”ë“œ ìŠ¤ìº”)          â”‚\n   â”‚                        â”‚\n   â”‚                        â”‚\n   â”‚   í˜„ì¬ ì‹œê°„ (30ì´ˆ ë‹¨ìœ„)   â”‚\n   â”‚        +                â”‚\n   â”‚   Secret Key            â”‚\n   â”‚        â†“                â”‚\n   â”‚   HMAC-SHA1            â”‚\n   â”‚        â†“                â”‚\n   â”‚   6ìë¦¬ ì½”ë“œ ìƒì„±        â”‚\n   â”‚                        â”‚\n   â”‚â—„â”€â”€ ì½”ë“œ ì…ë ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\n   â”‚   ì„œë²„ì—ì„œë„ ê°™ì€        â”‚\n   â”‚   ê³„ì‚° í›„ ë¹„êµ ê²€ì¦      â”‚\n```"
            },
            {
                "type": "code",
                "title": "ğŸ’» êµ¬í˜„ ì½”ë“œ",
                "content": "### TOTP ê¸°ë°˜ 2FA êµ¬í˜„ (Google Authenticator)\n\n```java\n// build.gradle\n// implementation 'dev.samstevens.totp:totp:1.7.1'\n\n@Service\n@RequiredArgsConstructor\npublic class TotpService {\n    \n    private final SecretGenerator secretGenerator = new DefaultSecretGenerator();\n    private final QrDataFactory qrDataFactory = new QrDataFactory();\n    private final QrGenerator qrGenerator = new ZxingPngQrGenerator();\n    private final CodeVerifier codeVerifier = new DefaultCodeVerifier();\n    \n    // 1. ë¹„ë°€ í‚¤ ìƒì„±\n    public String generateSecret() {\n        return secretGenerator.generate();\n    }\n    \n    // 2. QR ì½”ë“œ ìƒì„± (ì•± ë“±ë¡ìš©)\n    public String generateQrCodeImage(String secret, String email) {\n        QrData qrData = qrDataFactory.newBuilder()\n            .label(email)\n            .secret(secret)\n            .issuer(\"MyApp\")  // ì•± ì´ë¦„\n            .algorithm(HashingAlgorithm.SHA1)\n            .digits(6)\n            .period(30)\n            .build();\n        \n        try {\n            byte[] imageData = qrGenerator.generate(qrData);\n            return Base64.getEncoder().encodeToString(imageData);\n        } catch (QrGenerationException e) {\n            throw new RuntimeException(\"QR ìƒì„± ì‹¤íŒ¨\", e);\n        }\n    }\n    \n    // 3. OTP ì½”ë“œ ê²€ì¦\n    public boolean verifyCode(String secret, String code) {\n        return codeVerifier.isValidCode(secret, code);\n    }\n}\n```\n\n### 2FA ì„¤ì • ë° ë¡œê·¸ì¸ í”Œë¡œìš°\n\n```java\n@Service\n@RequiredArgsConstructor\npublic class MfaService {\n    \n    private final TotpService totpService;\n    private final UserRepository userRepository;\n    private final PasswordEncoder passwordEncoder;\n    \n    // 2FA í™œì„±í™” ì‹œì‘\n    public MfaSetupResponse setupMfa(Long userId) {\n        User user = userRepository.findById(userId).orElseThrow();\n        \n        // ë¹„ë°€ í‚¤ ìƒì„±\n        String secret = totpService.generateSecret();\n        \n        // ì„ì‹œ ì €ì¥ (í™•ì¸ ì „ê¹Œì§€)\n        user.setTempMfaSecret(secret);\n        userRepository.save(user);\n        \n        // QR ì½”ë“œ ì´ë¯¸ì§€ ìƒì„±\n        String qrCode = totpService.generateQrCodeImage(secret, user.getEmail());\n        \n        return MfaSetupResponse.builder()\n            .secret(secret)  // ìˆ˜ë™ ì…ë ¥ìš©\n            .qrCode(qrCode)  // QR ìŠ¤ìº”ìš©\n            .build();\n    }\n    \n    // 2FA í™œì„±í™” í™•ì¸\n    public void confirmMfa(Long userId, String code) {\n        User user = userRepository.findById(userId).orElseThrow();\n        \n        if (user.getTempMfaSecret() == null) {\n            throw new MfaException(\"MFA ì„¤ì •ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤\");\n        }\n        \n        // ì½”ë“œ ê²€ì¦\n        if (!totpService.verifyCode(user.getTempMfaSecret(), code)) {\n            throw new MfaException(\"ìœ íš¨í•˜ì§€ ì•Šì€ ì¸ì¦ ì½”ë“œì…ë‹ˆë‹¤\");\n        }\n        \n        // í™œì„±í™”\n        user.setMfaSecret(user.getTempMfaSecret());\n        user.setTempMfaSecret(null);\n        user.setMfaEnabled(true);\n        userRepository.save(user);\n    }\n    \n    // ë¡œê·¸ì¸ 2ë‹¨ê³„ ì¸ì¦\n    public LoginResponse login(String email, String password, String mfaCode) {\n        User user = userRepository.findByEmail(email)\n            .orElseThrow(() -> new AuthException(\"ì¸ì¦ ì‹¤íŒ¨\"));\n        \n        // 1ë‹¨ê³„: ë¹„ë°€ë²ˆí˜¸ í™•ì¸\n        if (!passwordEncoder.matches(password, user.getPassword())) {\n            throw new AuthException(\"ì¸ì¦ ì‹¤íŒ¨\");\n        }\n        \n        // 2ë‹¨ê³„: MFA í™•ì¸ (í™œì„±í™”ëœ ê²½ìš°)\n        if (user.isMfaEnabled()) {\n            if (mfaCode == null || mfaCode.isEmpty()) {\n                return LoginResponse.builder()\n                    .requiresMfa(true)\n                    .tempToken(generateTempToken(user))  // ì„ì‹œ í† í°\n                    .build();\n            }\n            \n            if (!totpService.verifyCode(user.getMfaSecret(), mfaCode)) {\n                throw new MfaException(\"ìœ íš¨í•˜ì§€ ì•Šì€ ì¸ì¦ ì½”ë“œì…ë‹ˆë‹¤\");\n            }\n        }\n        \n        // ë¡œê·¸ì¸ ì„±ê³µ\n        return LoginResponse.builder()\n            .accessToken(generateAccessToken(user))\n            .build();\n    }\n}\n```\n\n### ë°±ì—… ì½”ë“œ ìƒì„±\n\n```java\n@Service\npublic class BackupCodeService {\n    \n    private static final int BACKUP_CODE_COUNT = 10;\n    private static final int CODE_LENGTH = 8;\n    \n    // ë°±ì—… ì½”ë“œ ìƒì„± (MFA ë¶„ì‹¤ ì‹œ ì‚¬ìš©)\n    public List<String> generateBackupCodes(User user) {\n        List<String> codes = new ArrayList<>();\n        SecureRandom random = new SecureRandom();\n        \n        for (int i = 0; i < BACKUP_CODE_COUNT; i++) {\n            String code = generateCode(random);\n            codes.add(code);\n        }\n        \n        // í•´ì‹œí•´ì„œ ì €ì¥\n        List<String> hashedCodes = codes.stream()\n            .map(code -> passwordEncoder.encode(code))\n            .toList();\n        \n        user.setBackupCodes(hashedCodes);\n        userRepository.save(user);\n        \n        return codes;  // ì›ë³¸ì€ ì‚¬ìš©ìì—ê²Œë§Œ í‘œì‹œ\n    }\n    \n    // ë°±ì—… ì½”ë“œë¡œ ì¸ì¦\n    public boolean verifyBackupCode(User user, String code) {\n        List<String> hashedCodes = user.getBackupCodes();\n        \n        for (int i = 0; i < hashedCodes.size(); i++) {\n            if (passwordEncoder.matches(code, hashedCodes.get(i))) {\n                // ì‚¬ìš©ëœ ì½”ë“œ ì œê±° (1íšŒìš©)\n                hashedCodes.remove(i);\n                userRepository.save(user);\n                return true;\n            }\n        }\n        return false;\n    }\n}\n```"
            },
            {
                "type": "code",
                "title": "ğŸ›¡ï¸ ì‹¤ì „ ë³´ì•ˆ",
                "content": "### SMS/ì´ë©”ì¼ OTP êµ¬í˜„\n\n```java\n@Service\n@RequiredArgsConstructor\npublic class OtpService {\n    \n    private final RedisTemplate<String, String> redisTemplate;\n    private final SmsService smsService;\n    private final EmailService emailService;\n    \n    private static final int OTP_LENGTH = 6;\n    private static final int OTP_EXPIRY_MINUTES = 5;\n    \n    // OTP ìƒì„± ë° ë°œì†¡\n    public void sendOtp(String identifier, OtpType type) {\n        String otp = generateOtp();\n        String key = \"otp:\" + type + \":\" + identifier;\n        \n        // Redisì— ì €ì¥ (5ë¶„ ë§Œë£Œ)\n        redisTemplate.opsForValue().set(key, otp, OTP_EXPIRY_MINUTES, TimeUnit.MINUTES);\n        \n        // ë°œì†¡\n        switch (type) {\n            case SMS -> smsService.send(identifier, \"ì¸ì¦ë²ˆí˜¸: \" + otp);\n            case EMAIL -> emailService.sendOtp(identifier, otp);\n        }\n    }\n    \n    // OTP ê²€ì¦\n    public boolean verifyOtp(String identifier, OtpType type, String code) {\n        String key = \"otp:\" + type + \":\" + identifier;\n        String storedOtp = redisTemplate.opsForValue().get(key);\n        \n        if (storedOtp != null && storedOtp.equals(code)) {\n            redisTemplate.delete(key);  // 1íšŒìš©\n            return true;\n        }\n        return false;\n    }\n    \n    private String generateOtp() {\n        SecureRandom random = new SecureRandom();\n        int otp = random.nextInt(900000) + 100000;  // 6ìë¦¬\n        return String.valueOf(otp);\n    }\n}\n```\n\n### FIDO2/WebAuthn ì—°ë™ (í•˜ë“œì›¨ì–´ í‚¤)\n\n```java\n// build.gradle\n// implementation 'com.webauthn4j:webauthn4j-core:0.22.0'\n\n@Service\n@RequiredArgsConstructor\npublic class WebAuthnService {\n    \n    private final WebAuthnManager webAuthnManager;\n    private final CredentialRepository credentialRepository;\n    \n    // ë“±ë¡ ì˜µì…˜ ìƒì„±\n    public PublicKeyCredentialCreationOptions generateRegistrationOptions(User user) {\n        return PublicKeyCredentialCreationOptions.builder()\n            .rp(RelyingPartyIdentity.builder()\n                .id(\"myapp.com\")\n                .name(\"MyApp\")\n                .build())\n            .user(UserIdentity.builder()\n                .name(user.getEmail())\n                .displayName(user.getName())\n                .id(ByteArray.fromBase64(user.getId().toString()))\n                .build())\n            .challenge(new ByteArray(generateChallenge()))\n            .pubKeyCredParams(List.of(\n                PublicKeyCredentialParameters.ES256,\n                PublicKeyCredentialParameters.RS256\n            ))\n            .authenticatorSelection(AuthenticatorSelectionCriteria.builder()\n                .userVerification(UserVerificationRequirement.PREFERRED)\n                .build())\n            .timeout(60000L)\n            .build();\n    }\n    \n    // ë“±ë¡ ê²€ì¦\n    public void verifyRegistration(User user, RegistrationResponse response) {\n        RegistrationData registrationData = webAuthnManager.validate(\n            response,\n            new RegistrationParameters(\n                serverProperty,\n                challengeRepository.loadChallenge(user.getId())\n            )\n        );\n        \n        // ìê²© ì¦ëª… ì €ì¥\n        WebAuthnCredential credential = WebAuthnCredential.builder()\n            .userId(user.getId())\n            .credentialId(registrationData.getAttestationObject().getAuthenticatorData().getCredentialId())\n            .publicKey(registrationData.getAttestationObject().getAuthenticatorData().getAttestedCredentialData().getCOSEKey())\n            .counter(registrationData.getAttestationObject().getAuthenticatorData().getSignCount())\n            .build();\n        \n        credentialRepository.save(credential);\n    }\n}\n```\n\n### MFA í”¼ë¡œ ê³µê²© ë°©ì§€\n\n```java\n@Service\npublic class MfaProtectionService {\n    \n    private final RedisTemplate<String, String> redisTemplate;\n    \n    // MFA ìš”ì²­ ì œí•œ (í”¼ë¡œ ê³µê²© ë°©ì§€)\n    public void checkMfaRateLimit(Long userId) {\n        String key = \"mfa:request:\" + userId;\n        String countStr = redisTemplate.opsForValue().get(key);\n        int count = countStr != null ? Integer.parseInt(countStr) : 0;\n        \n        if (count >= 3) {  // 5ë¶„ ë‚´ 3íšŒ ì´ˆê³¼\n            throw new MfaException(\"ë„ˆë¬´ ë§ì€ ì¸ì¦ ìš”ì²­ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.\");\n        }\n        \n        redisTemplate.opsForValue().increment(key);\n        redisTemplate.expire(key, 5, TimeUnit.MINUTES);\n    }\n    \n    // ìˆ«ì ë§¤ì¹­ ë°©ì‹ (í‘¸ì‹œ ì•Œë¦¼ìš©)\n    public NumberMatchChallenge generateNumberMatch() {\n        SecureRandom random = new SecureRandom();\n        int correctNumber = random.nextInt(100);  // 0-99\n        \n        List<Integer> options = new ArrayList<>();\n        options.add(correctNumber);\n        \n        while (options.size() < 3) {\n            int option = random.nextInt(100);\n            if (!options.contains(option)) {\n                options.add(option);\n            }\n        }\n        Collections.shuffle(options);\n        \n        return NumberMatchChallenge.builder()\n            .correctNumber(correctNumber)\n            .options(options)\n            .build();\n    }\n}\n```"
            },
            {
                "type": "tip",
                "title": "ğŸ’¡ ì²´í¬ë¦¬ìŠ¤íŠ¸ & ë©´ì ‘",
                "content": "### ì‹¤ë¬´ ì²´í¬ë¦¬ìŠ¤íŠ¸\n\n```\n[ TOTP êµ¬í˜„ ]\nâ–¡ ë¹„ë°€ í‚¤ ì•ˆì „í•˜ê²Œ ì €ì¥ (ì•”í˜¸í™”)\nâ–¡ ì‹œê°„ ë™ê¸°í™” ê³ ë ¤ (1-2 ìœˆë„ìš° í—ˆìš©)\nâ–¡ QR ì½”ë“œ + ìˆ˜ë™ ì…ë ¥ ëª¨ë‘ ì§€ì›\nâ–¡ ë°±ì—… ì½”ë“œ ì œê³µ (10ê°œ, 1íšŒìš©)\n\n[ ë³´ì•ˆ ]\nâ–¡ SMS 2FAëŠ” ë³´ì¡° ìˆ˜ë‹¨ìœ¼ë¡œë§Œ ì‚¬ìš©\nâ–¡ MFA í”¼ë¡œ ê³µê²© ë°©ì§€ (ìš”ì²­ ì œí•œ)\nâ–¡ ë°±ì—… ì½”ë“œ í•´ì‹œ ì €ì¥\nâ–¡ MFA ë¹„í™œì„±í™” ì‹œ ì¬ì¸ì¦ í•„ìˆ˜\n\n[ UX ]\nâ–¡ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë””ë°”ì´ìŠ¤ ê¸°ì–µ ì˜µì…˜\nâ–¡ MFA ë¶„ì‹¤ ì‹œ ë³µêµ¬ ì ˆì°¨ ì•ˆë‚´\nâ–¡ ì„¤ì • ë³€ê²½ ì‹œ ì•Œë¦¼ ë°œì†¡\n\n[ ê³ ê¸‰ ]\nâ–¡ ê´€ë¦¬ì/ê³ ìœ„í—˜ ì‘ì—…ì€ MFA í•„ìˆ˜\nâ–¡ í•˜ë“œì›¨ì–´ í‚¤(FIDO2) ì§€ì› ê²€í† \nâ–¡ ì ì‘í˜• MFA (ìœ„í—˜ë„ ê¸°ë°˜ ì¶”ê°€ ì¸ì¦)\n```\n\n---\n\n### ë©´ì ‘ ì˜ˆìƒ ì§ˆë¬¸\n\n```\nğŸ‘¶ ì£¼ë‹ˆì–´ ë ˆë²¨:\n\nQ: 2FAì™€ MFAì˜ ì°¨ì´ëŠ”?\nA: 2FAëŠ” 2ê°œ ìš”ì†Œ, MFAëŠ” 2ê°œ ì´ìƒ ìš”ì†Œ.\n   ì‹¤ì§ˆì ìœ¼ë¡œ ê°™ì€ ì˜ë¯¸ë¡œ ë§ì´ ì‚¬ìš©ë¨.\n\nQ: TOTPëŠ” ì–´ë–»ê²Œ ë™ì‘í•˜ë‚˜ìš”?\nA: ë¹„ë°€ í‚¤ + í˜„ì¬ ì‹œê°„(30ì´ˆ ë‹¨ìœ„)ì„ HMAC-SHA1ë¡œ í•´ì‹œí•˜ì—¬ 6ìë¦¬ ì½”ë“œ ìƒì„±.\n   ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ê°€ ê°™ì€ í‚¤ì™€ ì‹œê°„ìœ¼ë¡œ ê³„ì‚°í•˜ì—¬ ë¹„êµ.\n\nQ: SMS 2FAê°€ ìœ„í—˜í•œ ì´ìœ ëŠ”?\nA: SIM ìŠ¤ì™€í•‘(í†µì‹ ì‚¬ ì‚¬íšŒê³µí•™), SS7 ì·¨ì•½ì , ë¬¸ì ê°€ë¡œì±„ê¸° ê°€ëŠ¥.\n   TOTPë‚˜ í•˜ë“œì›¨ì–´ í‚¤ê°€ ë” ì•ˆì „.\n\nğŸ‘¨â€ğŸ’¼ ì‹œë‹ˆì–´ ë ˆë²¨:\n\nQ: MFA í”¼ë¡œ ê³µê²©ê³¼ ëŒ€ì‘ ë°©ë²•ì€?\nA: ë°˜ë³µì  í‘¸ì‹œ ì•Œë¦¼ìœ¼ë¡œ ì‹¤ìˆ˜ ìœ ë„. ëŒ€ì‘: ìš”ì²­ íšŸìˆ˜ ì œí•œ,\n   ìˆ«ì ë§¤ì¹­ ë°©ì‹, ìœ„ì¹˜/ì‹œê°„ ê¸°ë°˜ ì´ìƒ íƒì§€.\n\nQ: íŒ¨ìŠ¤í‚¤(Passkey)ì™€ FIDO2ì˜ ì°¨ì´ëŠ”?\nA: FIDO2ëŠ” í‘œì¤€ í”„ë¡œí† ì½œ, íŒ¨ìŠ¤í‚¤ëŠ” FIDO2 ê¸°ë°˜ êµ¬í˜„ì²´.\n   íŒ¨ìŠ¤í‚¤ëŠ” í´ë¼ìš°ë“œ ë™ê¸°í™”ë˜ì–´ ì—¬ëŸ¬ ê¸°ê¸°ì—ì„œ ì‚¬ìš© ê°€ëŠ¥.\n\nQ: ì ì‘í˜• MFAë€?\nA: ìœ„í—˜ë„ì— ë”°ë¼ ë™ì ìœ¼ë¡œ MFA ìš”êµ¬. í‰ì†Œ ìœ„ì¹˜/ì‹œê°„ì´ë©´ íŒ¨ìŠ¤,\n   ìƒˆ ë””ë°”ì´ìŠ¤/í•´ì™¸ ì ‘ì†ì´ë©´ ì¶”ê°€ ì¸ì¦ ìš”êµ¬.\n```\n\n---\n\n### MFA ë°©ì‹ë³„ ê¶Œì¥ ì‚¬ìš©ì²˜\n\n```\në°©ì‹        â”‚ ì¼ë°˜ ì„œë¹„ìŠ¤ â”‚ ê¸ˆìœµ/ì˜ë£Œ â”‚ ê´€ë¦¬ì\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€\nSMS OTP     â”‚ â–³ ë³´ì¡°ìš©   â”‚ âŒ        â”‚ âŒ\nEmail OTP   â”‚ â–³ ë³´ì¡°ìš©   â”‚ âŒ        â”‚ âŒ\nTOTP (ì•±)   â”‚ âœ… ê¶Œì¥    â”‚ âœ… ê¶Œì¥   â”‚ âœ… ê¶Œì¥\nPush ì•Œë¦¼   â”‚ âœ… ê¶Œì¥    â”‚ âœ… ê¶Œì¥   â”‚ âœ… ê¶Œì¥\ní•˜ë“œì›¨ì–´ í‚¤  â”‚ â–³ ì„ íƒ    â”‚ âœ… í•„ìˆ˜   â”‚ âœ… í•„ìˆ˜\n```"
            }
        ]
    }


def update_security_json():
    """Update security.json with authentication content"""

    file_path = r"c:\tools\codemaster-next-main\codemaster-next-main\codemaster-next-main\src\data\contents\security.json"

    # Read existing file
    with open(file_path, 'r', encoding='utf-8') as f:
        data = json.load(f)

    # Update topics
    topics = [
        get_authentication_content(),
        get_authorization_content(),
        get_password_security_content(),
        get_mfa_content()
    ]

    for topic in topics:
        topic_id = topic["id"]
        data[topic_id] = topic
        print(f"Updated: {topic_id}")

    # Write back to file
    with open(file_path, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

    print(f"\nSuccessfully updated {len(topics)} topics in security.json")


if __name__ == "__main__":
    update_security_json()
